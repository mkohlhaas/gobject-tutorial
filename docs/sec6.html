  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>GObject tutorial</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      pre{overflow: visible;}
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::after
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
      div.sourceCode { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      pre:not(.sourceCode) { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      table {margin-left: auto; margin-right: auto; border-collapse: collapse; border: 1px solid;}
      th {padding: 2px 6px; border: 1px solid; background-color: ghostwhite;}
      td {padding: 2px 6px; border: 1px solid;}
      img {display: block; margin-left: auto; margin-right: auto;}
      figcaption {text-align: center;}
    </style>
  </head>
  <body style="padding-top: 70px;">
    <div class="container">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <span class="navbar-brand">GObject tutorial</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
<a class="nav-link" href="index.html">Home</a>
</li>

            <li class="nav-item">
<a class="nav-link" href="sec5.html">Prev: section5</a>
</li>

            <li class="nav-item">
<a class="nav-link" href="sec7.html">Next: section7</a>
</li>

          </ul>
        </div>
      </div>
    </nav>
<h1 id="derivable-type-and-abstract-type">Derivable type and abstract
type</h1>
<h2 id="derivable-type">Derivable type</h2>
<p>There are two kinds of types, final type and derivable type. Final
type doesn’t have any child object. Derivable type has child
objects.</p>
<p>The main difference between the two objects is their classes. Final
type objects doesn’t have its own class area. The only member of the
class is its parent class.</p>
<p>Derivable object has its own area in the class. The class is open to
its descendants.</p>
<p><code>G_DECLARE_DERIVABLE_TYPE</code> is used to declare derivable
type. It is written in a header file like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define T_TYPE_NUMBER             </span><span class="op">(</span><span class="pp">t_number_get_type </span><span class="op">())</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>G_DECLARE_DERIVABLE_TYPE <span class="op">(</span>TNumber<span class="op">,</span> t_number<span class="op">,</span> T<span class="op">,</span> NUMBER<span class="op">,</span> GObject<span class="op">)</span></span></code></pre></div>
<h2 id="abstract-type">Abstract type</h2>
<p>Abstract type doesn’t have any instance. This type of object is
derivable and its children can use functions and signals of the abstract
object.</p>
<p>The examples of this section are TNumber, TInt and TDouble object.
TInt and TDouble have already been made in the previous section. They
represent integer and floating point respectively. Numbers are more
abstract than integer and floating point.</p>
<p>TNumber is an abstract object which represents numbers. TNumber is a
parent object of TInt and TDouble. TNumber isn’t instantiated because
its type is abstract. When an instance has TInt or TDouble type, it is
an instance of TNumber as well.</p>
<p>TInt and TDouble have five operations: addition, subtraction,
multiplication, division and unary minus operation. Those operations can
be defined on TNumber object.</p>
<p>In this section we will define TNumber object and five functions
above. In addition, <code>to_s</code> function will be added. It
converts the value of TNumber into a string. It is like sprintf
function. And we will rewrite TInt and TDouble to implement the
functions.</p>
<h2 id="tnumber-class">TNumber class</h2>
<p><code>tnumber.h</code> is a header file for the TNumber class.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1"></a><span class="pp">#pragma once</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="pp">#define T_TYPE_NUMBER             </span><span class="op">(</span><span class="pp">t_number_get_type </span><span class="op">())</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>G_DECLARE_DERIVABLE_TYPE <span class="op">(</span>TNumber<span class="op">,</span> t_number<span class="op">,</span> T<span class="op">,</span> NUMBER<span class="op">,</span> GObject<span class="op">)</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">struct</span> _TNumberClass <span class="op">{</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  GObjectClass parent_class<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  TNumber<span class="op">*</span> <span class="op">(*</span>add<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  TNumber<span class="op">*</span> <span class="op">(*</span>sub<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>  TNumber<span class="op">*</span> <span class="op">(*</span>mul<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>  TNumber<span class="op">*</span> <span class="op">(*</span>div<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>  TNumber<span class="op">*</span> <span class="op">(*</span>uminus<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="dt">char</span> <span class="op">*</span> <span class="op">(*</span>to_s<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="co">/* signal */</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="dt">void</span> <span class="op">(*</span>div_by_zero<span class="op">)</span> <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="op">};</span></span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">/* arithmetic operator */</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">/* These operators create a new instance and return a pointer to it. */</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>TNumber <span class="op">*</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>t_number_add <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-24"><a href="#cb2-24"></a></span>
<span id="cb2-25"><a href="#cb2-25"></a>TNumber <span class="op">*</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>t_number_sub <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a>TNumber <span class="op">*</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>t_number_mul <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a>TNumber <span class="op">*</span></span>
<span id="cb2-32"><a href="#cb2-32"></a>t_number_div <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">);</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a>TNumber <span class="op">*</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>t_number_uminus <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb2-36"><a href="#cb2-36"></a></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="dt">char</span> <span class="op">*</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>t_number_to_s <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">);</span></span></code></pre></div>
<ul>
<li>6: <code>G_DECLARE_DERIVABLE_TYPE</code> macro. This is similar to
<code>G_DECLARE_FINAL_TYPE</code> macro. The difference is derivable or
final. <code>G_DECLARE_DERIVABLE_TYPE</code> is expanded to:
<ul>
<li>Declaration of <code>t_number_get_type ()</code> function. This
function must be defined in <code>tnumber.c</code> file. The definition
is usually done with <code>G_DEFINE_TYPE</code> or its family
macros.</li>
<li>Definition of TNumber instance, whose member is its parent
only.</li>
<li>Declaration of TNumberClass. It should be defined later in the
header file.</li>
<li>Convenience macros <code>T_NUMBER</code> (cast to instance),
<code>T_NUMBER_CLASS</code> (cast to class), <code>T_IS_NUMBER</code>
(instance check), <code>T_IS_NUMBER_CLASS</code> (class check) and
<code>T_NUMBER_GET_CLASS</code> are defined.</li>
<li><code>g_autoptr()</code> support.</li>
</ul></li>
<li>8-18: Definition of the structure of TNumberClass.</li>
<li>10-15: These are pointers to functions. They are called class
methods or virtual functions. They are expected to be overridden in the
descendant object. The methods are five arithmetic operators and
<code>to_s</code> function. <code>to_s</code> function is similar to
sprintf function.</li>
<li>17: A pointer to the default signal handler of “div-by-zero” signal.
The offset of this pointer is given to <code>g_signal_new</code> as an
argument.</li>
<li>22-38: Functions. They are public.</li>
</ul>
<p><code>tnumber.c</code> is as follows.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1"></a><span class="pp">#include </span><span class="im">&quot;tnumber.h&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="dt">static</span> guint t_number_signal<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>G_DEFINE_ABSTRACT_TYPE <span class="op">(</span>TNumber<span class="op">,</span> t_number<span class="op">,</span> G_TYPE_OBJECT<span class="op">)</span></span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>div_by_zero_default_cb <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  g_printerr <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error: division by zero.</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="op">}</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>t_number_class_init <span class="op">(</span>TNumberClass <span class="op">*</span>class<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="co">/* virtual functions */</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>  class<span class="op">-&gt;</span>add <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>  class<span class="op">-&gt;</span>sub <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  class<span class="op">-&gt;</span>mul <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>  class<span class="op">-&gt;</span>div <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  class<span class="op">-&gt;</span>uminus <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  class<span class="op">-&gt;</span>to_s <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="co">/* default signal handler */</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  class<span class="op">-&gt;</span>div_by_zero <span class="op">=</span> div_by_zero_default_cb<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="co">/* signal */</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>  t_number_signal <span class="op">=</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>  g_signal_new <span class="op">(</span><span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>                G_TYPE_FROM_CLASS <span class="op">(</span>class<span class="op">),</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>                G_SIGNAL_RUN_LAST <span class="op">|</span> G_SIGNAL_NO_RECURSE <span class="op">|</span> G_SIGNAL_NO_HOOKS<span class="op">,</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>                G_STRUCT_OFFSET <span class="op">(</span>TNumberClass<span class="op">,</span> div_by_zero<span class="op">),</span></span>
<span id="cb3-30"><a href="#cb3-30"></a>                NULL <span class="co">/* accumulator */</span><span class="op">,</span></span>
<span id="cb3-31"><a href="#cb3-31"></a>                NULL <span class="co">/* accumulator data */</span><span class="op">,</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>                NULL <span class="co">/* C marshaller */</span><span class="op">,</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>                G_TYPE_NONE <span class="co">/* return_type */</span><span class="op">,</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>                <span class="dv">0</span>     <span class="co">/* n_params */</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>                <span class="op">);</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="op">}</span></span>
<span id="cb3-37"><a href="#cb3-37"></a></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>t_number_init <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="op">}</span></span>
<span id="cb3-41"><a href="#cb3-41"></a></span>
<span id="cb3-42"><a href="#cb3-42"></a>TNumber <span class="op">*</span></span>
<span id="cb3-43"><a href="#cb3-43"></a>t_number_add <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-46"><a href="#cb3-46"></a></span>
<span id="cb3-47"><a href="#cb3-47"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-48"><a href="#cb3-48"></a></span>
<span id="cb3-49"><a href="#cb3-49"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>add <span class="op">?</span> class<span class="op">-&gt;</span>add <span class="op">(</span>self<span class="op">,</span> other<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="op">}</span></span>
<span id="cb3-51"><a href="#cb3-51"></a></span>
<span id="cb3-52"><a href="#cb3-52"></a>TNumber <span class="op">*</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>t_number_sub <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-55"><a href="#cb3-55"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>sub <span class="op">?</span> class<span class="op">-&gt;</span>sub <span class="op">(</span>self<span class="op">,</span> other<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="op">}</span></span>
<span id="cb3-61"><a href="#cb3-61"></a></span>
<span id="cb3-62"><a href="#cb3-62"></a>TNumber <span class="op">*</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>t_number_mul <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-64"><a href="#cb3-64"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-65"><a href="#cb3-65"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-68"><a href="#cb3-68"></a></span>
<span id="cb3-69"><a href="#cb3-69"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>mul <span class="op">?</span> class<span class="op">-&gt;</span>mul <span class="op">(</span>self<span class="op">,</span> other<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="op">}</span></span>
<span id="cb3-71"><a href="#cb3-71"></a></span>
<span id="cb3-72"><a href="#cb3-72"></a>TNumber <span class="op">*</span></span>
<span id="cb3-73"><a href="#cb3-73"></a>t_number_div <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-74"><a href="#cb3-74"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-75"><a href="#cb3-75"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-76"><a href="#cb3-76"></a></span>
<span id="cb3-77"><a href="#cb3-77"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-78"><a href="#cb3-78"></a></span>
<span id="cb3-79"><a href="#cb3-79"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>div <span class="op">?</span> class<span class="op">-&gt;</span>div <span class="op">(</span>self<span class="op">,</span> other<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="op">}</span></span>
<span id="cb3-81"><a href="#cb3-81"></a></span>
<span id="cb3-82"><a href="#cb3-82"></a>TNumber <span class="op">*</span></span>
<span id="cb3-83"><a href="#cb3-83"></a>t_number_uminus <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-84"><a href="#cb3-84"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-85"><a href="#cb3-85"></a></span>
<span id="cb3-86"><a href="#cb3-86"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-87"><a href="#cb3-87"></a></span>
<span id="cb3-88"><a href="#cb3-88"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>uminus <span class="op">?</span> class<span class="op">-&gt;</span>uminus <span class="op">(</span>self<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-89"><a href="#cb3-89"></a><span class="op">}</span></span>
<span id="cb3-90"><a href="#cb3-90"></a></span>
<span id="cb3-91"><a href="#cb3-91"></a><span class="dt">char</span> <span class="op">*</span></span>
<span id="cb3-92"><a href="#cb3-92"></a>t_number_to_s <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-93"><a href="#cb3-93"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_NUMBER <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb3-94"><a href="#cb3-94"></a></span>
<span id="cb3-95"><a href="#cb3-95"></a>  TNumberClass <span class="op">*</span>class <span class="op">=</span> T_NUMBER_GET_CLASS<span class="op">(</span>self<span class="op">);</span></span>
<span id="cb3-96"><a href="#cb3-96"></a></span>
<span id="cb3-97"><a href="#cb3-97"></a>  <span class="cf">return</span> class<span class="op">-&gt;</span>to_s <span class="op">?</span> class<span class="op">-&gt;</span>to_s <span class="op">(</span>self<span class="op">)</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>5: <code>G_DEFINE_ABSTRACT_TYPE</code> macro. This macro is used to
define an abstract type object. Abstract type isn’t instantiated. This
macro is expanded to:
<ul>
<li>Declaration of <code>t_number_init ()</code> function.</li>
<li>Declaration of <code>t_number_class_init ()</code> function.</li>
<li>Definition of <code>t_number_get_type ()</code> function.</li>
<li>Definition of <code>t_number_parent_class</code> static variable
that points the parent class.</li>
</ul></li>
<li>3, 7-10, 26-35: Defines division-by-zero signal. The function
<code>div_by_zero_default_cb</code> is a default handler of
“div-by-zero” signal. Default handler doesn’t have user data parameter.
The function <code>g_signal_new</code> is used instead of
<code>g_signal_new_class_handler</code>. It specifies a handler as the
offset from the top of the class to the pointer to the handler.</li>
<li>12-36: The class initialization function
<code>t_number_class_init</code>.</li>
<li>16-21: These class methods are virtual functions. They are expected
to be overridden in the descendant object of TNumber. NULL is assigned
here so that nothing happens when the methods are called.</li>
<li>23: Assigns the address of the function
<code>dev_by_zero_default_cb</code> to
<code>class-&gt;div_by_zero</code>. This is the default handler of
“div-by-zero” signal.</li>
<li>38-40: <code>t_number_init</code> is a initialization function for
an instance. But abstract object isn’t instantiated. So, nothing is done
in this function. But you can’t leave out the definition of this
function.</li>
<li>42-98: Public functions. These functions just call the corresponding
class methods if the pointer to the class method is not NULL.</li>
</ul>
<h2 id="tint-object.">TInt object.</h2>
<p><code>tint.h</code> is a header file of the TInt class. TInt is a
child class of TNumber.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1"></a><span class="pp">#pragma once</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="pp">#define T_TYPE_INT  </span><span class="op">(</span><span class="pp">t_int_get_type </span><span class="op">())</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>G_DECLARE_FINAL_TYPE <span class="op">(</span>TInt<span class="op">,</span> t_int<span class="op">,</span> T<span class="op">,</span> INT<span class="op">,</span> TNumber<span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">/* create a new TInt instance */</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>TInt <span class="op">*</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>t_int_new_with_value <span class="op">(</span><span class="dt">int</span> value<span class="op">);</span></span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>TInt <span class="op">*</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>t_int_new <span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>9-13:Declares public functions. Arithmetic functions and
<code>to_s</code> are declared in TNumber, so TInt doesn’t declare those
functions. Only instance creation functions are declared.</li>
</ul>
<p>The C file <code>tint.c</code> implements virtual functions (class
methods). And the pointers of the methods in TNumberClass are rewritten
here.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1"></a><span class="pp">#include </span><span class="im">&quot;tnumber.h&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="pp">#include </span><span class="im">&quot;tint.h&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="pp">#define PROP_INT </span><span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="dt">static</span> GParamSpec <span class="op">*</span>int_property <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="kw">struct</span> _TInt <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  TNumber parent<span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="op">};</span></span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>G_DEFINE_TYPE <span class="op">(</span>TInt<span class="op">,</span> t_int<span class="op">,</span> T_TYPE_NUMBER<span class="op">)</span></span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>t_int_set_property <span class="op">(</span>GObject <span class="op">*</span>object<span class="op">,</span> guint property_id<span class="op">,</span> <span class="dt">const</span> GValue <span class="op">*</span>value<span class="op">,</span> GParamSpec <span class="op">*</span>pspec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>  TInt <span class="op">*</span>self <span class="op">=</span> T_INT <span class="op">(</span>object<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="cf">if</span> <span class="op">(</span>property_id <span class="op">==</span> PROP_INT<span class="op">)</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>    self<span class="op">-&gt;</span>value <span class="op">=</span> g_value_get_int <span class="op">(</span>value<span class="op">);</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>  <span class="cf">else</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID <span class="op">(</span>object<span class="op">,</span> property_id<span class="op">,</span> pspec<span class="op">);</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="op">}</span></span>
<span id="cb5-24"><a href="#cb5-24"></a></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>t_int_get_property <span class="op">(</span>GObject <span class="op">*</span>object<span class="op">,</span> guint property_id<span class="op">,</span> GValue <span class="op">*</span>value<span class="op">,</span> GParamSpec <span class="op">*</span>pspec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>  TInt <span class="op">*</span>self <span class="op">=</span> T_INT <span class="op">(</span>object<span class="op">);</span></span>
<span id="cb5-28"><a href="#cb5-28"></a></span>
<span id="cb5-29"><a href="#cb5-29"></a>  <span class="cf">if</span> <span class="op">(</span>property_id <span class="op">==</span> PROP_INT<span class="op">)</span></span>
<span id="cb5-30"><a href="#cb5-30"></a>    g_value_set_int <span class="op">(</span>value<span class="op">,</span> self<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>  <span class="cf">else</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID <span class="op">(</span>object<span class="op">,</span> property_id<span class="op">,</span> pspec<span class="op">);</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="op">}</span></span>
<span id="cb5-34"><a href="#cb5-34"></a></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>t_int_init <span class="op">(</span>TInt <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="op">}</span></span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="co">/* arithmetic operator */</span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="co">/* These operators create a new instance and return a pointer to it. */</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="pp">#define t_int_binary_op</span><span class="op">(</span><span class="pp">op</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="pp">  </span><span class="dt">int</span><span class="pp"> i</span><span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-43"><a href="#cb5-43"></a><span class="pp">  </span><span class="dt">double</span><span class="pp"> d</span><span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="pp">  </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span><span class="pp">T_IS_INT </span><span class="op">(</span><span class="pp">other</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="pp">    g_object_get </span><span class="op">(</span><span class="pp">T_INT </span><span class="op">(</span><span class="pp">other</span><span class="op">),</span><span class="pp"> </span><span class="st">&quot;value&quot;</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span><span class="pp">i</span><span class="op">,</span><span class="pp"> NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="pp">    </span><span class="cf">return</span><span class="pp">  T_NUMBER </span><span class="op">(</span><span class="pp">t_int_new_with_value </span><span class="op">(</span><span class="pp">T_INT</span><span class="op">(</span><span class="pp">self</span><span class="op">)-&gt;</span><span class="pp">value op i</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="pp">  </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="pp">    g_object_get </span><span class="op">(</span><span class="pp">T_DOUBLE </span><span class="op">(</span><span class="pp">other</span><span class="op">),</span><span class="pp"> </span><span class="st">&quot;value&quot;</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span><span class="pp">d</span><span class="op">,</span><span class="pp"> NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-49"><a href="#cb5-49"></a><span class="pp">    </span><span class="cf">return</span><span class="pp">  T_NUMBER </span><span class="op">(</span><span class="pp">t_int_new_with_value </span><span class="op">(</span><span class="pp">T_INT</span><span class="op">(</span><span class="pp">self</span><span class="op">)-&gt;</span><span class="pp">value op </span><span class="op">(</span><span class="dt">int</span><span class="op">)</span><span class="pp"> d</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb5-50"><a href="#cb5-50"></a><span class="pp">  </span><span class="op">}</span></span>
<span id="cb5-51"><a href="#cb5-51"></a></span>
<span id="cb5-52"><a href="#cb5-52"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>t_int_add <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-54"><a href="#cb5-54"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-55"><a href="#cb5-55"></a></span>
<span id="cb5-56"><a href="#cb5-56"></a>  t_int_binary_op <span class="op">(+)</span></span>
<span id="cb5-57"><a href="#cb5-57"></a><span class="op">}</span></span>
<span id="cb5-58"><a href="#cb5-58"></a></span>
<span id="cb5-59"><a href="#cb5-59"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb5-60"><a href="#cb5-60"></a>t_int_sub <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-61"><a href="#cb5-61"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-62"><a href="#cb5-62"></a></span>
<span id="cb5-63"><a href="#cb5-63"></a>  t_int_binary_op <span class="op">(-)</span></span>
<span id="cb5-64"><a href="#cb5-64"></a><span class="op">}</span></span>
<span id="cb5-65"><a href="#cb5-65"></a></span>
<span id="cb5-66"><a href="#cb5-66"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb5-67"><a href="#cb5-67"></a>t_int_mul <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-68"><a href="#cb5-68"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-69"><a href="#cb5-69"></a></span>
<span id="cb5-70"><a href="#cb5-70"></a>  t_int_binary_op <span class="op">(*)</span></span>
<span id="cb5-71"><a href="#cb5-71"></a><span class="op">}</span></span>
<span id="cb5-72"><a href="#cb5-72"></a></span>
<span id="cb5-73"><a href="#cb5-73"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb5-74"><a href="#cb5-74"></a>t_int_div <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-75"><a href="#cb5-75"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-76"><a href="#cb5-76"></a></span>
<span id="cb5-77"><a href="#cb5-77"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb5-78"><a href="#cb5-78"></a>  <span class="dt">double</span> d<span class="op">;</span></span>
<span id="cb5-79"><a href="#cb5-79"></a></span>
<span id="cb5-80"><a href="#cb5-80"></a>  <span class="cf">if</span> <span class="op">(</span>T_IS_INT <span class="op">(</span>other<span class="op">))</span> <span class="op">{</span></span>
<span id="cb5-81"><a href="#cb5-81"></a>    g_object_get <span class="op">(</span>T_INT <span class="op">(</span>other<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>i<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb5-82"><a href="#cb5-82"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-83"><a href="#cb5-83"></a>      g_signal_emit_by_name <span class="op">(</span>self<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">);</span></span>
<span id="cb5-84"><a href="#cb5-84"></a>      <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb5-85"><a href="#cb5-85"></a>    <span class="op">}</span> <span class="cf">else</span></span>
<span id="cb5-86"><a href="#cb5-86"></a>      <span class="cf">return</span>  T_NUMBER <span class="op">(</span>t_int_new_with_value <span class="op">(</span>T_INT<span class="op">(</span>self<span class="op">)-&gt;</span>value <span class="op">/</span> i<span class="op">));</span></span>
<span id="cb5-87"><a href="#cb5-87"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb5-88"><a href="#cb5-88"></a>    g_object_get <span class="op">(</span>T_DOUBLE <span class="op">(</span>other<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>d<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb5-89"><a href="#cb5-89"></a>    <span class="cf">if</span> <span class="op">(</span>d <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-90"><a href="#cb5-90"></a>      g_signal_emit_by_name <span class="op">(</span>self<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">);</span></span>
<span id="cb5-91"><a href="#cb5-91"></a>      <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb5-92"><a href="#cb5-92"></a>    <span class="op">}</span> <span class="cf">else</span></span>
<span id="cb5-93"><a href="#cb5-93"></a>      <span class="cf">return</span>  T_NUMBER <span class="op">(</span>t_int_new_with_value <span class="op">(</span>T_INT<span class="op">(</span>self<span class="op">)-&gt;</span>value <span class="op">/</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>  d<span class="op">));</span></span>
<span id="cb5-94"><a href="#cb5-94"></a>  <span class="op">}</span></span>
<span id="cb5-95"><a href="#cb5-95"></a><span class="op">}</span></span>
<span id="cb5-96"><a href="#cb5-96"></a></span>
<span id="cb5-97"><a href="#cb5-97"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb5-98"><a href="#cb5-98"></a>t_int_uminus <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-99"><a href="#cb5-99"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-100"><a href="#cb5-100"></a></span>
<span id="cb5-101"><a href="#cb5-101"></a>  <span class="cf">return</span> T_NUMBER <span class="op">(</span>t_int_new_with_value <span class="op">(-</span> T_INT<span class="op">(</span>self<span class="op">)-&gt;</span>value<span class="op">));</span></span>
<span id="cb5-102"><a href="#cb5-102"></a><span class="op">}</span></span>
<span id="cb5-103"><a href="#cb5-103"></a></span>
<span id="cb5-104"><a href="#cb5-104"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span></span>
<span id="cb5-105"><a href="#cb5-105"></a>t_int_to_s <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-106"><a href="#cb5-106"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_INT <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb5-107"><a href="#cb5-107"></a></span>
<span id="cb5-108"><a href="#cb5-108"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb5-109"><a href="#cb5-109"></a></span>
<span id="cb5-110"><a href="#cb5-110"></a>  g_object_get <span class="op">(</span>T_INT <span class="op">(</span>self<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>i<span class="op">,</span> NULL<span class="op">);</span> </span>
<span id="cb5-111"><a href="#cb5-111"></a>  <span class="cf">return</span> g_strdup_printf <span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb5-112"><a href="#cb5-112"></a><span class="op">}</span></span>
<span id="cb5-113"><a href="#cb5-113"></a></span>
<span id="cb5-114"><a href="#cb5-114"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb5-115"><a href="#cb5-115"></a>t_int_class_init <span class="op">(</span>TIntClass <span class="op">*</span>class<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-116"><a href="#cb5-116"></a>  TNumberClass <span class="op">*</span>tnumber_class <span class="op">=</span> T_NUMBER_CLASS <span class="op">(</span>class<span class="op">);</span></span>
<span id="cb5-117"><a href="#cb5-117"></a>  GObjectClass <span class="op">*</span>gobject_class <span class="op">=</span> G_OBJECT_CLASS <span class="op">(</span>class<span class="op">);</span></span>
<span id="cb5-118"><a href="#cb5-118"></a></span>
<span id="cb5-119"><a href="#cb5-119"></a>  <span class="co">/* override virtual functions */</span></span>
<span id="cb5-120"><a href="#cb5-120"></a>  tnumber_class<span class="op">-&gt;</span>add <span class="op">=</span> t_int_add<span class="op">;</span></span>
<span id="cb5-121"><a href="#cb5-121"></a>  tnumber_class<span class="op">-&gt;</span>sub <span class="op">=</span> t_int_sub<span class="op">;</span></span>
<span id="cb5-122"><a href="#cb5-122"></a>  tnumber_class<span class="op">-&gt;</span>mul <span class="op">=</span> t_int_mul<span class="op">;</span></span>
<span id="cb5-123"><a href="#cb5-123"></a>  tnumber_class<span class="op">-&gt;</span>div <span class="op">=</span> t_int_div<span class="op">;</span></span>
<span id="cb5-124"><a href="#cb5-124"></a>  tnumber_class<span class="op">-&gt;</span>uminus <span class="op">=</span> t_int_uminus<span class="op">;</span></span>
<span id="cb5-125"><a href="#cb5-125"></a>  tnumber_class<span class="op">-&gt;</span>to_s <span class="op">=</span> t_int_to_s<span class="op">;</span></span>
<span id="cb5-126"><a href="#cb5-126"></a></span>
<span id="cb5-127"><a href="#cb5-127"></a>  gobject_class<span class="op">-&gt;</span>set_property <span class="op">=</span> t_int_set_property<span class="op">;</span></span>
<span id="cb5-128"><a href="#cb5-128"></a>  gobject_class<span class="op">-&gt;</span>get_property <span class="op">=</span> t_int_get_property<span class="op">;</span></span>
<span id="cb5-129"><a href="#cb5-129"></a>  int_property <span class="op">=</span> g_param_spec_int <span class="op">(</span><span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="st">&quot;val&quot;</span><span class="op">,</span> <span class="st">&quot;Integer value&quot;</span><span class="op">,</span> G_MININT<span class="op">,</span> G_MAXINT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> G_PARAM_READWRITE<span class="op">);</span></span>
<span id="cb5-130"><a href="#cb5-130"></a>  g_object_class_install_property <span class="op">(</span>gobject_class<span class="op">,</span> PROP_INT<span class="op">,</span> int_property<span class="op">);</span></span>
<span id="cb5-131"><a href="#cb5-131"></a><span class="op">}</span></span>
<span id="cb5-132"><a href="#cb5-132"></a></span>
<span id="cb5-133"><a href="#cb5-133"></a>TInt <span class="op">*</span></span>
<span id="cb5-134"><a href="#cb5-134"></a>t_int_new_with_value <span class="op">(</span><span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-135"><a href="#cb5-135"></a>  TInt <span class="op">*</span>i<span class="op">;</span></span>
<span id="cb5-136"><a href="#cb5-136"></a></span>
<span id="cb5-137"><a href="#cb5-137"></a>  i <span class="op">=</span> g_object_new <span class="op">(</span>T_TYPE_INT<span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> value<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb5-138"><a href="#cb5-138"></a>  <span class="cf">return</span> i<span class="op">;</span></span>
<span id="cb5-139"><a href="#cb5-139"></a><span class="op">}</span></span>
<span id="cb5-140"><a href="#cb5-140"></a></span>
<span id="cb5-141"><a href="#cb5-141"></a>TInt <span class="op">*</span></span>
<span id="cb5-142"><a href="#cb5-142"></a>t_int_new <span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-143"><a href="#cb5-143"></a>  TInt <span class="op">*</span>i<span class="op">;</span></span>
<span id="cb5-144"><a href="#cb5-144"></a></span>
<span id="cb5-145"><a href="#cb5-145"></a>  i <span class="op">=</span> g_object_new <span class="op">(</span>T_TYPE_INT<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb5-146"><a href="#cb5-146"></a>  <span class="cf">return</span> i<span class="op">;</span></span>
<span id="cb5-147"><a href="#cb5-147"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>5-6, 15-33, 127-130: Definition of the property “value”. This is the
same as before.</li>
<li>8-11: Definition of the structure of TInt. This must be defined
before <code>G_DEFINE_TYPE</code>.</li>
<li>13: <code>G_DEFINE_TYPE</code> macro. This macro expands to:
<ul>
<li>Declaration of <code>t_int_init ()</code> function.</li>
<li>Definition of <code>t_int_get_type ()</code> function.</li>
<li>Definition of <code>t_int_parent_class</code> static variable which
points the parent class.</li>
</ul></li>
<li>35-37: <code>t_int_init</code>.</li>
<li>41-112: These functions are connected to the class method pointers
in TIntClass. They are the implementation of the virtual functions
defined in <code>tnumber.c</code>.</li>
<li>41-50: Defines a macro used in <code>t_int_add</code>,
<code>t_int_sub</code> and <code>t_int_mul</code>. This macro is similar
to <code>t_int_div</code> function. Refer to the explanation below for
<code>t_int_div</code>.</li>
<li>52-71: The functions <code>t_int_add</code>, <code>t_int_sub</code>
and <code>t_int_mul</code>. The macro <code>t_int_binary_op</code> is
used.</li>
<li>73-95: The function <code>t_int_div</code>. The first argument
<code>self</code> is the object on which the function is called. The
second argument <code>other</code> is another TNumber object. It can be
TInt or TDouble. If it is TDouble, its value is casted to int before the
division is performed. If the divisor (<code>other</code>) is zero,
“div-by-zero” signal is emitted. The signal is defined in TNumber, so
TInt doesn’t know the signal id. Therefore, the emission is done with
<code>g_signal_emit_by_name</code> instead of
<code>g_signal_emit</code>. The return value of <code>t_int_div</code>
is TNumber type object However, because TNumber is abstract, the actual
type of the object is TInt.</li>
<li>97-102: A function for unary minus operator.</li>
<li>104-112: The function <code>to_s</code>. This function converts int
to string. For example, if the value of the object is 123, then the
result is a string “123”. The caller should free the string if it
becomes useless.</li>
<li>114- 131: The class initialization function
<code>t_int_class_init</code>.</li>
<li>120-125: The class methods are overridden. For example, if
<code>t_number_add</code> is called on a TInt object, then the function
calls the class method <code>*tnumber_class-&gt;add</code>. The pointer
points <code>t_int_add</code> function. Therefore,
<code>t_int_add</code> is finally called.</li>
<li>133-147: Instance creation functions are the same as before.</li>
</ul>
<h2 id="tdouble-object.">TDouble object.</h2>
<p>TDouble object is defined with <code>tdouble.h</code> and
<code>tdouble.c</code>. The definition is very similar to TInt. So, this
subsection just shows the contents of the files.</p>
<p>tdouble.h</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1"></a><span class="pp">#pragma once</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="pp">#define T_TYPE_DOUBLE  </span><span class="op">(</span><span class="pp">t_double_get_type </span><span class="op">())</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>G_DECLARE_FINAL_TYPE <span class="op">(</span>TDouble<span class="op">,</span> t_double<span class="op">,</span> T<span class="op">,</span> DOUBLE<span class="op">,</span> TNumber<span class="op">)</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">/* create a new TDouble instance */</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>TDouble <span class="op">*</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>t_double_new_with_value <span class="op">(</span><span class="dt">double</span> value<span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>TDouble <span class="op">*</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>t_double_new <span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
<p>tdouble.c</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1"></a><span class="pp">#include </span><span class="im">&quot;tnumber.h&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="pp">#include </span><span class="im">&quot;tint.h&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="pp">#define PROP_DOUBLE </span><span class="dv">1</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="dt">static</span> GParamSpec <span class="op">*</span>double_property <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">struct</span> _TDouble <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  TNumber parent<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="op">};</span></span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a>G_DEFINE_TYPE <span class="op">(</span>TDouble<span class="op">,</span> t_double<span class="op">,</span> T_TYPE_NUMBER<span class="op">)</span></span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>t_double_set_property <span class="op">(</span>GObject <span class="op">*</span>object<span class="op">,</span> guint property_id<span class="op">,</span> <span class="dt">const</span> GValue <span class="op">*</span>value<span class="op">,</span> GParamSpec <span class="op">*</span>pspec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  TDouble <span class="op">*</span>self <span class="op">=</span> T_DOUBLE <span class="op">(</span>object<span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="cf">if</span> <span class="op">(</span>property_id <span class="op">==</span> PROP_DOUBLE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>    self<span class="op">-&gt;</span>value <span class="op">=</span> g_value_get_double <span class="op">(</span>value<span class="op">);</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="op">}</span> <span class="cf">else</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID <span class="op">(</span>object<span class="op">,</span> property_id<span class="op">,</span> pspec<span class="op">);</span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="op">}</span></span>
<span id="cb7-23"><a href="#cb7-23"></a></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>t_double_get_property <span class="op">(</span>GObject <span class="op">*</span>object<span class="op">,</span> guint property_id<span class="op">,</span> GValue <span class="op">*</span>value<span class="op">,</span> GParamSpec <span class="op">*</span>pspec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  TDouble <span class="op">*</span>self <span class="op">=</span> T_DOUBLE <span class="op">(</span>object<span class="op">);</span></span>
<span id="cb7-27"><a href="#cb7-27"></a></span>
<span id="cb7-28"><a href="#cb7-28"></a>  <span class="cf">if</span> <span class="op">(</span>property_id <span class="op">==</span> PROP_DOUBLE<span class="op">)</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>    g_value_set_double <span class="op">(</span>value<span class="op">,</span> self<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="cf">else</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>    G_OBJECT_WARN_INVALID_PROPERTY_ID <span class="op">(</span>object<span class="op">,</span> property_id<span class="op">,</span> pspec<span class="op">);</span></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="op">}</span></span>
<span id="cb7-33"><a href="#cb7-33"></a></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-35"><a href="#cb7-35"></a>t_double_init <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="op">}</span></span>
<span id="cb7-37"><a href="#cb7-37"></a></span>
<span id="cb7-38"><a href="#cb7-38"></a><span class="co">/* arithmetic operator */</span></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co">/* These operators create a new instance and return a pointer to it. */</span></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="pp">#define t_double_binary_op</span><span class="op">(</span><span class="pp">op</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="pp">  </span><span class="dt">int</span><span class="pp"> i</span><span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="pp">  </span><span class="dt">double</span><span class="pp"> d</span><span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="pp">  </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span><span class="pp">T_IS_INT </span><span class="op">(</span><span class="pp">other</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="pp">    g_object_get </span><span class="op">(</span><span class="pp">T_INT </span><span class="op">(</span><span class="pp">other</span><span class="op">),</span><span class="pp"> </span><span class="st">&quot;value&quot;</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span><span class="pp">i</span><span class="op">,</span><span class="pp"> NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="pp">    </span><span class="cf">return</span><span class="pp">  T_NUMBER </span><span class="op">(</span><span class="pp">t_double_new_with_value </span><span class="op">(</span><span class="pp">T_DOUBLE</span><span class="op">(</span><span class="pp">self</span><span class="op">)-&gt;</span><span class="pp">value op </span><span class="op">(</span><span class="dt">double</span><span class="op">)</span><span class="pp"> i</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="pp">  </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="pp">    g_object_get </span><span class="op">(</span><span class="pp">T_DOUBLE </span><span class="op">(</span><span class="pp">other</span><span class="op">),</span><span class="pp"> </span><span class="st">&quot;value&quot;</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span><span class="pp">d</span><span class="op">,</span><span class="pp"> NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-48"><a href="#cb7-48"></a><span class="pp">    </span><span class="cf">return</span><span class="pp">  T_NUMBER </span><span class="op">(</span><span class="pp">t_double_new_with_value </span><span class="op">(</span><span class="pp">T_DOUBLE</span><span class="op">(</span><span class="pp">self</span><span class="op">)-&gt;</span><span class="pp">value op d</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb7-49"><a href="#cb7-49"></a><span class="pp">  </span><span class="op">}</span></span>
<span id="cb7-50"><a href="#cb7-50"></a></span>
<span id="cb7-51"><a href="#cb7-51"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb7-52"><a href="#cb7-52"></a>t_double_add <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-53"><a href="#cb7-53"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-54"><a href="#cb7-54"></a></span>
<span id="cb7-55"><a href="#cb7-55"></a>  t_double_binary_op <span class="op">(+)</span></span>
<span id="cb7-56"><a href="#cb7-56"></a><span class="op">}</span></span>
<span id="cb7-57"><a href="#cb7-57"></a></span>
<span id="cb7-58"><a href="#cb7-58"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb7-59"><a href="#cb7-59"></a>t_double_sub <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-60"><a href="#cb7-60"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-61"><a href="#cb7-61"></a></span>
<span id="cb7-62"><a href="#cb7-62"></a>  t_double_binary_op <span class="op">(-)</span></span>
<span id="cb7-63"><a href="#cb7-63"></a><span class="op">}</span></span>
<span id="cb7-64"><a href="#cb7-64"></a></span>
<span id="cb7-65"><a href="#cb7-65"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb7-66"><a href="#cb7-66"></a>t_double_mul <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-67"><a href="#cb7-67"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-68"><a href="#cb7-68"></a></span>
<span id="cb7-69"><a href="#cb7-69"></a>  t_double_binary_op <span class="op">(*)</span></span>
<span id="cb7-70"><a href="#cb7-70"></a><span class="op">}</span></span>
<span id="cb7-71"><a href="#cb7-71"></a></span>
<span id="cb7-72"><a href="#cb7-72"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb7-73"><a href="#cb7-73"></a>t_double_div <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">,</span> TNumber <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-74"><a href="#cb7-74"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-75"><a href="#cb7-75"></a></span>
<span id="cb7-76"><a href="#cb7-76"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb7-77"><a href="#cb7-77"></a>  <span class="dt">double</span> d<span class="op">;</span></span>
<span id="cb7-78"><a href="#cb7-78"></a></span>
<span id="cb7-79"><a href="#cb7-79"></a>  <span class="cf">if</span> <span class="op">(</span>T_IS_INT <span class="op">(</span>other<span class="op">))</span> <span class="op">{</span></span>
<span id="cb7-80"><a href="#cb7-80"></a>    g_object_get <span class="op">(</span>T_INT <span class="op">(</span>other<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>i<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb7-81"><a href="#cb7-81"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-82"><a href="#cb7-82"></a>      g_signal_emit_by_name <span class="op">(</span>self<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">);</span></span>
<span id="cb7-83"><a href="#cb7-83"></a>      <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb7-84"><a href="#cb7-84"></a>    <span class="op">}</span> <span class="cf">else</span></span>
<span id="cb7-85"><a href="#cb7-85"></a>      <span class="cf">return</span>  T_NUMBER <span class="op">(</span>t_double_new_with_value <span class="op">(</span>T_DOUBLE<span class="op">(</span>self<span class="op">)-&gt;</span>value <span class="op">/</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> i<span class="op">));</span></span>
<span id="cb7-86"><a href="#cb7-86"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-87"><a href="#cb7-87"></a>    g_object_get <span class="op">(</span>T_DOUBLE <span class="op">(</span>other<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>d<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb7-88"><a href="#cb7-88"></a>    <span class="cf">if</span> <span class="op">(</span>d <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-89"><a href="#cb7-89"></a>      g_signal_emit_by_name <span class="op">(</span>self<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">);</span></span>
<span id="cb7-90"><a href="#cb7-90"></a>      <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb7-91"><a href="#cb7-91"></a>    <span class="op">}</span> <span class="cf">else</span></span>
<span id="cb7-92"><a href="#cb7-92"></a>      <span class="cf">return</span>  T_NUMBER <span class="op">(</span>t_double_new_with_value <span class="op">(</span>T_DOUBLE<span class="op">(</span>self<span class="op">)-&gt;</span>value <span class="op">/</span> d<span class="op">));</span></span>
<span id="cb7-93"><a href="#cb7-93"></a>  <span class="op">}</span></span>
<span id="cb7-94"><a href="#cb7-94"></a><span class="op">}</span></span>
<span id="cb7-95"><a href="#cb7-95"></a></span>
<span id="cb7-96"><a href="#cb7-96"></a><span class="dt">static</span> TNumber <span class="op">*</span></span>
<span id="cb7-97"><a href="#cb7-97"></a>t_double_uminus <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-98"><a href="#cb7-98"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-99"><a href="#cb7-99"></a></span>
<span id="cb7-100"><a href="#cb7-100"></a>  <span class="cf">return</span> T_NUMBER <span class="op">(</span>t_double_new_with_value <span class="op">(-</span> T_DOUBLE<span class="op">(</span>self<span class="op">)-&gt;</span>value<span class="op">));</span></span>
<span id="cb7-101"><a href="#cb7-101"></a><span class="op">}</span></span>
<span id="cb7-102"><a href="#cb7-102"></a></span>
<span id="cb7-103"><a href="#cb7-103"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span></span>
<span id="cb7-104"><a href="#cb7-104"></a>t_double_to_s <span class="op">(</span>TNumber <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-105"><a href="#cb7-105"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb7-106"><a href="#cb7-106"></a></span>
<span id="cb7-107"><a href="#cb7-107"></a>  <span class="dt">double</span> d<span class="op">;</span></span>
<span id="cb7-108"><a href="#cb7-108"></a></span>
<span id="cb7-109"><a href="#cb7-109"></a>  g_object_get <span class="op">(</span>T_DOUBLE <span class="op">(</span>self<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>d<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb7-110"><a href="#cb7-110"></a>  <span class="cf">return</span> g_strdup_printf <span class="op">(</span><span class="st">&quot;</span><span class="sc">%lf</span><span class="st">&quot;</span><span class="op">,</span> d<span class="op">);</span></span>
<span id="cb7-111"><a href="#cb7-111"></a><span class="op">}</span></span>
<span id="cb7-112"><a href="#cb7-112"></a></span>
<span id="cb7-113"><a href="#cb7-113"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-114"><a href="#cb7-114"></a>t_double_class_init <span class="op">(</span>TDoubleClass <span class="op">*</span>class<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-115"><a href="#cb7-115"></a>  TNumberClass <span class="op">*</span>tnumber_class <span class="op">=</span> T_NUMBER_CLASS <span class="op">(</span>class<span class="op">);</span></span>
<span id="cb7-116"><a href="#cb7-116"></a>  GObjectClass <span class="op">*</span>gobject_class <span class="op">=</span> G_OBJECT_CLASS <span class="op">(</span>class<span class="op">);</span></span>
<span id="cb7-117"><a href="#cb7-117"></a></span>
<span id="cb7-118"><a href="#cb7-118"></a>  <span class="co">/* override virtual functions */</span></span>
<span id="cb7-119"><a href="#cb7-119"></a>  tnumber_class<span class="op">-&gt;</span>add <span class="op">=</span> t_double_add<span class="op">;</span></span>
<span id="cb7-120"><a href="#cb7-120"></a>  tnumber_class<span class="op">-&gt;</span>sub <span class="op">=</span> t_double_sub<span class="op">;</span></span>
<span id="cb7-121"><a href="#cb7-121"></a>  tnumber_class<span class="op">-&gt;</span>mul <span class="op">=</span> t_double_mul<span class="op">;</span></span>
<span id="cb7-122"><a href="#cb7-122"></a>  tnumber_class<span class="op">-&gt;</span>div <span class="op">=</span> t_double_div<span class="op">;</span></span>
<span id="cb7-123"><a href="#cb7-123"></a>  tnumber_class<span class="op">-&gt;</span>uminus <span class="op">=</span> t_double_uminus<span class="op">;</span></span>
<span id="cb7-124"><a href="#cb7-124"></a>  tnumber_class<span class="op">-&gt;</span>to_s <span class="op">=</span> t_double_to_s<span class="op">;</span></span>
<span id="cb7-125"><a href="#cb7-125"></a></span>
<span id="cb7-126"><a href="#cb7-126"></a>  gobject_class<span class="op">-&gt;</span>set_property <span class="op">=</span> t_double_set_property<span class="op">;</span></span>
<span id="cb7-127"><a href="#cb7-127"></a>  gobject_class<span class="op">-&gt;</span>get_property <span class="op">=</span> t_double_get_property<span class="op">;</span></span>
<span id="cb7-128"><a href="#cb7-128"></a>  double_property <span class="op">=</span> g_param_spec_double <span class="op">(</span><span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="st">&quot;val&quot;</span><span class="op">,</span> <span class="st">&quot;Double value&quot;</span><span class="op">,</span> <span class="op">-</span>G_MAXDOUBLE<span class="op">,</span> G_MAXDOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> G_PARAM_READWRITE<span class="op">);</span></span>
<span id="cb7-129"><a href="#cb7-129"></a>  g_object_class_install_property <span class="op">(</span>gobject_class<span class="op">,</span> PROP_DOUBLE<span class="op">,</span> double_property<span class="op">);</span></span>
<span id="cb7-130"><a href="#cb7-130"></a><span class="op">}</span></span>
<span id="cb7-131"><a href="#cb7-131"></a></span>
<span id="cb7-132"><a href="#cb7-132"></a>TDouble <span class="op">*</span></span>
<span id="cb7-133"><a href="#cb7-133"></a>t_double_new_with_value <span class="op">(</span><span class="dt">double</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-134"><a href="#cb7-134"></a>  TDouble <span class="op">*</span>d<span class="op">;</span></span>
<span id="cb7-135"><a href="#cb7-135"></a></span>
<span id="cb7-136"><a href="#cb7-136"></a>  d <span class="op">=</span> g_object_new <span class="op">(</span>T_TYPE_DOUBLE<span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> value<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb7-137"><a href="#cb7-137"></a>  <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb7-138"><a href="#cb7-138"></a><span class="op">}</span></span>
<span id="cb7-139"><a href="#cb7-139"></a></span>
<span id="cb7-140"><a href="#cb7-140"></a>TDouble <span class="op">*</span></span>
<span id="cb7-141"><a href="#cb7-141"></a>t_double_new <span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-142"><a href="#cb7-142"></a>  TDouble <span class="op">*</span>d<span class="op">;</span></span>
<span id="cb7-143"><a href="#cb7-143"></a></span>
<span id="cb7-144"><a href="#cb7-144"></a>  d <span class="op">=</span> g_object_new <span class="op">(</span>T_TYPE_DOUBLE<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb7-145"><a href="#cb7-145"></a>  <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb7-146"><a href="#cb7-146"></a><span class="op">}</span></span></code></pre></div>
<h2 id="main.c">main.c</h2>
<p><code>main.c</code> is a simple program to test the objects.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="pp">#include </span><span class="im">&quot;tnumber.h&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="pp">#include </span><span class="im">&quot;tint.h&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>notify_cb <span class="op">(</span>GObject <span class="op">*</span>gobject<span class="op">,</span> GParamSpec <span class="op">*</span>pspec<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="dt">double</span> d<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a>  name <span class="op">=</span> g_param_spec_get_name <span class="op">(</span>pspec<span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="cf">if</span> <span class="op">(</span>T_IS_INT <span class="op">(</span>gobject<span class="op">)</span> <span class="op">&amp;&amp;</span> strcmp <span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>    g_object_get <span class="op">(</span>T_INT <span class="op">(</span>gobject<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>i<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    g_print <span class="op">(</span><span class="st">&quot;Property </span><span class="sc">\&quot;%s\&quot;</span><span class="st"> is set to </span><span class="sc">%d</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> name<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>gobject<span class="op">)</span> <span class="op">&amp;&amp;</span> strcmp <span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;value&quot;</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    g_object_get <span class="op">(</span>T_DOUBLE <span class="op">(</span>gobject<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="op">&amp;</span>d<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    g_print <span class="op">(</span><span class="st">&quot;Property </span><span class="sc">\&quot;%s\&quot;</span><span class="st"> is set to </span><span class="sc">%lf</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> name<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="op">}</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="op">}</span></span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="dt">int</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>  TNumber <span class="op">*</span>i<span class="op">,</span> <span class="op">*</span>d<span class="op">,</span> <span class="op">*</span>num<span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="dt">char</span> <span class="op">*</span>si<span class="op">,</span> <span class="op">*</span>sd<span class="op">,</span> <span class="op">*</span>snum<span class="op">;</span></span>
<span id="cb8-26"><a href="#cb8-26"></a></span>
<span id="cb8-27"><a href="#cb8-27"></a>  i <span class="op">=</span> T_NUMBER <span class="op">(</span>t_int_new <span class="op">());</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>  d <span class="op">=</span> T_NUMBER <span class="op">(</span>t_double_new <span class="op">());</span></span>
<span id="cb8-29"><a href="#cb8-29"></a></span>
<span id="cb8-30"><a href="#cb8-30"></a>  g_signal_connect <span class="op">(</span>G_OBJECT <span class="op">(</span>i<span class="op">),</span> <span class="st">&quot;notify::value&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>notify_cb<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>  g_signal_connect <span class="op">(</span>G_OBJECT <span class="op">(</span>d<span class="op">),</span> <span class="st">&quot;notify::value&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>notify_cb<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb8-32"><a href="#cb8-32"></a></span>
<span id="cb8-33"><a href="#cb8-33"></a>  g_object_set <span class="op">(</span>T_INT <span class="op">(</span>i<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>  g_object_set <span class="op">(</span>T_DOUBLE <span class="op">(</span>d<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="fl">12.345</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb8-35"><a href="#cb8-35"></a></span>
<span id="cb8-36"><a href="#cb8-36"></a>  num <span class="op">=</span> t_number_add <span class="op">(</span>i<span class="op">,</span> d<span class="op">);</span></span>
<span id="cb8-37"><a href="#cb8-37"></a></span>
<span id="cb8-38"><a href="#cb8-38"></a>  si <span class="op">=</span> t_number_to_s <span class="op">(</span>i<span class="op">);</span></span>
<span id="cb8-39"><a href="#cb8-39"></a>  sd <span class="op">=</span> t_number_to_s <span class="op">(</span>d<span class="op">);</span></span>
<span id="cb8-40"><a href="#cb8-40"></a>  snum <span class="op">=</span> t_number_to_s <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-41"><a href="#cb8-41"></a></span>
<span id="cb8-42"><a href="#cb8-42"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st"> + </span><span class="sc">%s</span><span class="st"> is </span><span class="sc">%s</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> si<span class="op">,</span> sd<span class="op">,</span> snum<span class="op">);</span></span>
<span id="cb8-43"><a href="#cb8-43"></a></span>
<span id="cb8-44"><a href="#cb8-44"></a>  g_object_unref <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-45"><a href="#cb8-45"></a>  g_free <span class="op">(</span>snum<span class="op">);</span></span>
<span id="cb8-46"><a href="#cb8-46"></a></span>
<span id="cb8-47"><a href="#cb8-47"></a>  num <span class="op">=</span> t_number_add <span class="op">(</span>d<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb8-48"><a href="#cb8-48"></a>  snum <span class="op">=</span> t_number_to_s <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-49"><a href="#cb8-49"></a></span>
<span id="cb8-50"><a href="#cb8-50"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st"> + </span><span class="sc">%s</span><span class="st"> is </span><span class="sc">%s</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> sd<span class="op">,</span> si<span class="op">,</span> snum<span class="op">);</span></span>
<span id="cb8-51"><a href="#cb8-51"></a></span>
<span id="cb8-52"><a href="#cb8-52"></a>  g_object_unref <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-53"><a href="#cb8-53"></a>  g_free <span class="op">(</span>sd<span class="op">);</span></span>
<span id="cb8-54"><a href="#cb8-54"></a>  g_free <span class="op">(</span>snum<span class="op">);</span></span>
<span id="cb8-55"><a href="#cb8-55"></a></span>
<span id="cb8-56"><a href="#cb8-56"></a>  g_object_set <span class="op">(</span>T_DOUBLE <span class="op">(</span>d<span class="op">),</span> <span class="st">&quot;value&quot;</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb8-57"><a href="#cb8-57"></a>  sd <span class="op">=</span> t_number_to_s <span class="op">(</span>d<span class="op">);</span></span>
<span id="cb8-58"><a href="#cb8-58"></a>  <span class="cf">if</span> <span class="op">((</span>num <span class="op">=</span> t_number_div<span class="op">(</span>i<span class="op">,</span> d<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-59"><a href="#cb8-59"></a>    snum <span class="op">=</span> t_number_to_s <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-60"><a href="#cb8-60"></a>    g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st"> / </span><span class="sc">%s</span><span class="st"> is </span><span class="sc">%s</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> si<span class="op">,</span> sd<span class="op">,</span> snum<span class="op">);</span></span>
<span id="cb8-61"><a href="#cb8-61"></a>    g_object_unref <span class="op">(</span>num<span class="op">);</span></span>
<span id="cb8-62"><a href="#cb8-62"></a>    g_free <span class="op">(</span>snum<span class="op">);</span></span>
<span id="cb8-63"><a href="#cb8-63"></a>  <span class="op">}</span></span>
<span id="cb8-64"><a href="#cb8-64"></a></span>
<span id="cb8-65"><a href="#cb8-65"></a>  g_object_unref <span class="op">(</span>i<span class="op">);</span></span>
<span id="cb8-66"><a href="#cb8-66"></a>  g_object_unref <span class="op">(</span>d<span class="op">);</span></span>
<span id="cb8-67"><a href="#cb8-67"></a>  g_free <span class="op">(</span>si<span class="op">);</span></span>
<span id="cb8-68"><a href="#cb8-68"></a>  g_free <span class="op">(</span>sd<span class="op">);</span></span>
<span id="cb8-69"><a href="#cb8-69"></a></span>
<span id="cb8-70"><a href="#cb8-70"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-71"><a href="#cb8-71"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>6-20: “notify” handler. This handler is upgraded to support both
TInt and TDouble.</li>
<li>22-71: The function <code>main</code>.</li>
<li>30-31: Connects the notify signals on <code>i</code> (TInt) and
<code>d</code> (TDouble).</li>
<li>33-34: Set “value” properties on <code>i</code> and
<code>d</code>.</li>
<li>36: Add <code>d</code> to <code>i</code>. The answer is TInt
object.</li>
<li>47: Add <code>i</code> to <code>d</code>. The answer is TDouble
object. The addition of two TNumber objects isn’t commutative because
the type of the result will be different if the two objects are
exchanged.</li>
<li>56-63: Tests division by zero signal.</li>
</ul>
<h2 id="compilation-and-execution">Compilation and execution</h2>
<p>The source files are located under src/tnumber. The file
<code>meson.buld</code>, which controls the compilation process, is as
follows.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode numberSource numberLines"><code class="sourceCode"><span id="cb9-1"><a href="#cb9-1"></a>project(&#39;tnumber&#39;, &#39;c&#39;)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>gobjdep = dependency(&#39;gobject-2.0&#39;)</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a>sourcefiles = files(&#39;main.c&#39;, &#39;tdouble.c&#39; &#39;tint.c&#39;, &#39;tnumber.c&#39;,)</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a>executable(&#39;tnumber&#39;, sourcefiles, dependencies: gobjdep, install: false)</span></code></pre></div>
<p>Compilation and execution is done by the usual way.</p>
<pre><code>$ cd src/tnumber
$ meson setup _build
$ ninja -C _build
$ _build/tnumber</code></pre>
<p>Then the following is shown on the display.</p>
<pre><code>Property &quot;value&quot; is set to 100.
Property &quot;value&quot; is set to 12.345000.
100 + 12.345000 is 112.
12.345000 + 100 is 112.345000.
Property &quot;value&quot; is set to 0.000000.

Error: division by zero.</code></pre>
<p>The two answers are different because of the different types.</p>
<p>This section has shown a simple example of derivable and abstract
class. You can define your derivable object like this. If your object
isn’t abstract, use <code>G_DEFINE_TYPE</code> instead of
<code>G_DEFINE_ABSTRACT_TYPE</code>. And you need one more thing, how to
manage private data in your derivable object. There is a tutorial in <a
href="https://docs.gtk.org/gobject/tutorial.html#gobject-tutorial">GObject
API Reference</a>. See the tutorial for learning derivable object.</p>
<p>It is also good to see source files in GTK.</p>
<h2 id="class-initialization-process">Class initialization process</h2>
<h3 id="initialization-process-of-tnumberclass">Initialization process
of TNumberClass</h3>
<p>Because TNumber is an abstract object, you cannot instantiate it
directly. And you cannot create the TNumber class as well. But when you
create its descendant instance, TNumber class is made and initialized.
First call for <code>g_object_new (T_TYPE_INT, ...)</code> or
<code>g_object_new (T_TYPE_DOUBLE, ...)</code> creates and initializes
TNumberClass if the class doesn’t exist. After that, TIntClass or
TDoubleClass is created and followed by the creation for TInt or TDouble
instance respectively.</p>
<p>And the initialization process for the TNumber class is as
follows.</p>
<ol type="1">
<li>GObjectClass has been initialized before the function
<code>main</code> starts.</li>
<li>Memory is allocated for TNumberClass.</li>
<li>The parent (GObjectClass) part of the class is copied from
GObjectClass.</li>
<li>The class initialization function <code>t_number_class_init</code>
is called. It initializes class methods (Pointers to the class methods)
and a default signal handler.</li>
</ol>
<p>The diagram below shows the process.</p>
<figure>
<img src="image/tnumberclass_init.png"
alt="TNumberClass initialization" />
<figcaption aria-hidden="true">TNumberClass initialization</figcaption>
</figure>
<h3 id="initialization-process-of-tintclass">Initialization process of
TIntClass</h3>
<ol type="1">
<li>TNumberClass has been initialized before the initialization of
TIntClass starts.</li>
<li>First call for <code>g_object_new (T_TYPE_INT, ...)</code>
initializes TIntClass. And the initialization process is as
follows.</li>
<li>Memory is allocated for TIntClass. TIntClass doesn’t have its own
area. Therefore its structure is the same as its parent class
(TNumberClass).</li>
<li>The parent (TNumberClass) part of the class (This is the same as
whole TIntClass) is copied from TNumberClass.</li>
<li>The class initialization function <code>t_int_class_init</code> is
called. It overrides class methods from TNumber,
<code>set_property</code> and <code>get_property</code>.</li>
</ol>
<p>The diagram below shows the process.</p>
<figure>
<img src="image/tintclass_init.png" alt="TIntClass initialization" />
<figcaption aria-hidden="true">TIntClass initialization</figcaption>
</figure>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
  </html>
